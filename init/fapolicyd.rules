# This is some sample rules that demonstrate some of the capabilities
# of the fapolicyd. The way that it works is that for each kind of
# executable you may have, you carve out what is acceptable (the whitelist)
# and then deny anything else of that type. The rules end with an allow
# anything to prevent unintended blockag to things like media files, documents,
# or anything else applications access that is not a computer langauge.

# Prevent execution by ld.so
deny_audit pattern=ld_so all

# We have to carve out an exception for the system updaters
# or things go very bad (deadlock).
allow exe=/usr/bin/rpm all
allow exe=%python3_path% comm=dnf all

# Only allow known ELF libs - this is ahead of executable because typical
# executable is linked with a dozen or more libraries.
allow all ftype=application/x-sharedlib obj_trust=1
deny_audit all ftype=application/x-sharedlib

# Only allow known ELF Applications
allow perm=execute all ftype=application/x-pie-executable obj_trust=1
allow perm=execute all ftype=application/x-executable obj_trust=1
deny_audit perm=execute all ftype=application/x-pie-executable
deny_audit perm=execute all ftype=application/x-executable

# Only allow system python executables and libs
# File type by: file --mime-type /path-to-file
allow all ftype=text/x-python obj_trust=1 dir=execdirs
allow exe=%python3_path% ftype=application/octet-stream obj_trust=1 dir=execdirs
allow exe=%python2_path% ftype=application/octet-stream obj_trust=1 dir=execdirs
deny_audit all ftype=text/x-python
#deny_audit all ftype=application/octet-stream path=*.pyc

#
# In this next optional languages section, choose either to
# block (default) or allow by commenting or uncommenting the
# appropriate line.
#

# Block all perl
deny_audit exe=/usr/bin/perl all

# Perl
#allow all dir=execdirs ftype=text/x-perl obj_trust=1
#deny_audit all ftype=text/x-perl

# Block all PHP
deny_audit exe=/usr/bin/php all

# PHP
#allow all dir=execdirs ftype=text/x-php obj_trust=1
#deny_audit all ftype=text/x-php

# Block all Ruby
deny_audit exe=/usr/bin/ruby all

# Ruby
#allow all dir=execdirs ftype=text/x-ruby obj_trust=1
#deny_audit  all ftype=text/x-ruby

# Data exfiltration
#deny_audit exe=/usr/bin/ssh dir=/opt
#deny_audit exe=/usr/bin/wget dir=/tmp
#deny_audit all device=/dev/cdrom

# Allow everything else
allow all all

